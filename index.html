<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="icon" type="image/webp" href="logo.webp">
  <title>Kalkulator RR 1:3</title>
  <link href="https://fonts.googleapis.com/css2?family=Comic+Neue:wght@700&display=swap" rel="stylesheet" />
  <style>
    * {
      box-sizing: border-box;
    }

    body {
      font-family: 'Comic Neue', cursive;
      background: #f7f7f7;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
      padding: 20px 0;
      margin: 0;
    }

    .container {
      background: white;
      border: 2px solid black;
      border-radius: 10px;
      padding: 24px 20px;
      width: 340px;
      box-shadow: 3px 3px 0 black;
    }

    h2 {
      margin-top: 0;
      font-size: 20px;
    }

    .note {
      font-size: 13px;
      color: #666;
      margin-bottom: 10px;
    }

    input {
      width: 100%;
      padding: 8px;
      border: 2px solid black;
      border-radius: 8px;
      font-size: 16px;
      text-align: center;
      margin-bottom: 10px;
      display: block;
    }

    .buttons {
      display: flex;
      gap: 10px;
      justify-content: center;
      margin-bottom: 10px;
    }

    button {
      width: 100%;
      font-size: 16px;
      font-weight: bold;
      border: 2px solid black;
      border-radius: 8px;
      cursor: pointer;
      transition: 0.2s;
      padding: 8px 0;
    }

    button:hover {
      transform: scale(1.03);
    }

    .buy {
      background: #d4f8d4;
    }

    .sell {
      background: #ffe4e4;
    }

    #result {
      margin-top: 20px;
      font-size: 15px;
      text-align: center;
      border-top: 2px dashed #aaa;
      padding-top: 8px;
    }

    /* ==================== RIWAYAT ==================== */
    #historyContainer {
      margin-top: 20px;
      border: 2px solid black;
      border-radius: 10px;
      padding: 10px;
      background: #fff;
    }

    #historyHeader {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 10px;
      cursor: pointer;
      padding: 2px 2px;
    }

    #historyHeader .header-left {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    #historyHeader h3 {
      margin: 0;
      font-size: 18px;
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .history-count {
      background: #ff0000;
      color: white;
      padding: 2px 8px;
      border-radius: 4px;
      font-size: 14px;
      font-weight: bold;
    }

    #resetBtn {
      font-size: 12px;
      border: 1.5px solid black;
      border-radius: 6px;
      background: #f8f8f8;
      cursor: pointer;
      padding: 4px 10px;
      font-family: inherit;
      transition: all 0.2s;
      flex-shrink: 0;
      width: auto;
    }

    #resetBtn:hover {
      background: #e0e0e0;
    }

    /* Collapse animation */
    #historyList {
      overflow: hidden;
      transition: max-height 0.4s cubic-bezier(0.4, 0, 0.2, 1), opacity 0.3s ease;
      max-height: 0;
      opacity: 0;
    }

    #historyList.show {
      max-height: 500px;
      opacity: 1;
      overflow-y: auto;
    }

    /* Items */
    .history-item {
      border: 2px solid black;
      border-radius: 10px;
      padding: 8px;
      margin-bottom: 10px;
      transition: transform 0.2s ease, opacity 0.4s ease;
      cursor: pointer;
      opacity: 0;
      animation: fadeIn 0.4s ease forwards;
    }

    .history-item:hover {
      transform: scale(1.02);
    }

    .buy-item {
      background: #d4f8d4;
    }

    .sell-item {
      background: #ffe4e4;
    }

    .top-line {
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .index {
      font-weight: bold;
      font-size: 1.1em;
    }

    .time {
      font-size: 0.85em;
      opacity: 0.8;
    }

    .empty-message {
      text-align: center;
      color: #777;
      font-size: 14px;
      font-style: italic;
      padding: 16px 0;
    }

    /* Panah */
    #arrowIcon {
      display: inline-block;
      transition: transform 0.3s ease;
      font-size: 16px;
    }

    #arrowIcon.rotate {
      transform: rotate(90deg);
    }

    @keyframes fadeIn {
      from {
        opacity: 0;
        transform: translateY(5px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    /* Footer */
    .footer {
      text-align: center;
      margin-top: 20px;
      font-size: 12px;
      color: #333;
    }

    .footer a {
      color: #333;
      text-decoration: none;
      position: relative;
      display: inline-block;
    }

    .footer a::after {
      content: '';
      position: absolute;
      width: 0;
      height: 2px;
      bottom: -2px;
      left: 0;
      background-color: #000;
      transition: width 0.3s ease;
    }

    .footer a:hover::after {
      width: 100%;
    }
  </style>
</head>

<body>
  <div class="container">
    <h2>üíπ Kalkulator RR 1:3</h2>
    <div class="note">Hitung harga TP & SL otomatis ‚Äî biar kamu fokus di entry üåø</div>

    <input id="priceInput" type="number" placeholder="Example: 2039" />

    <div class="buttons">
      <button class="buy" onclick="calculateRR('BUY')">BUY</button>
      <button class="sell" onclick="calculateRR('SELL')">SELL</button>
    </div>

    <div id="result"></div>

    <!-- RIWAYAT -->
    <div id="historyContainer">
      <div id="historyHeader" onclick="toggleHistory()">
        <div class="header-left">
          <span id="arrowIcon">‚ñ∂Ô∏è</span>
          <h3><span class="history-count" id="historyCount">0</span> Riwayat</h3>
        </div>
        <button id="resetBtn" onclick="resetHistory(event)">Reset</button>
      </div>
      <div id="historyList" class="empty-message">Belum ada Data yang tersedia saat ini!</div>
    </div>
  </div>

  <div class="footer">
    <div>Dari Sidoarjo ‚ù§Ô∏è untuk Semua!</div>
    <a href="https://saweria.co/rzkjanuarr" target="_blank">Support untuk menantikan Tools yang serupa!</a>
  </div>

  <script>
    const historyList = document.getElementById("historyList");
    let historyData = [];

    // Load history dari localStorage saat halaman dimuat
    function loadHistory() {
      const saved = localStorage.getItem('rrHistory');
      if (saved) {
        historyData = JSON.parse(saved);
        if (historyData.length > 0) {
          historyList.classList.remove("empty-message");
          historyList.innerHTML = "";
          historyData.forEach((item, idx) => {
            renderHistoryItem(item, historyData.length - idx);
          });
        }
      }
      updateHistoryCount();
    }

    // Update jumlah history
    function updateHistoryCount() {
      document.getElementById('historyCount').textContent = historyData.length;
    }

    // Simpan history ke localStorage
    function saveHistory() {
      localStorage.setItem('rrHistory', JSON.stringify(historyData));
    }

    // Render satu item history
    function renderHistoryItem(item, index) {
      const div = document.createElement("div");
      div.classList.add("history-item", item.type === "BUY" ? "buy-item" : "sell-item");
      div.innerHTML = `
        <div class="top-line">
          <div class="index">${index}</div>
          <div class="time">${item.time}</div>
        </div>
        <div>Entry : ${item.entry}</div>
        <div>üéØ TP : ${item.tp}</div>
        <div>üí• SL : ${item.sl}</div>
      `;
      historyList.prepend(div);
    }

    function addToHistory(type, entry, tp, sl) {
      // Hapus pesan kosong kalau ada
      if (historyList.classList.contains("empty-message")) {
        historyList.classList.remove("empty-message");
        historyList.innerHTML = "";
      }

      const now = new Date();
      const time = now.toLocaleString("id-ID", {
        day: "2-digit",
        month: "2-digit",
        year: "2-digit",
        hour: "2-digit",
        minute: "2-digit",
      });

      const newItem = { type, entry, tp, sl, time };
      historyData.push(newItem);
      saveHistory();
      updateHistoryCount();

      renderHistoryItem(newItem, historyData.length);
    }

    function calculateRR(type) {
      const input = parseFloat(document.getElementById("priceInput").value);
      if (isNaN(input)) {
        alert("Masukkan angka yang valid, bro üòÖ");
        return;
      }

      let entry = input / 1000;
      let tp, sl;

      if (type === "SELL") {
        tp = (input - 30) / 1000;
        sl = (input + 15) / 1000;
      } else {
        tp = (input + 30) / 1000;
        sl = (input - 15) / 1000;
      }

      const result = `
        <table style="width: 100%; border-collapse: collapse; margin-top: 10px;">
          <tr style="border-bottom: 2px solid #ddd;">
            <th style="text-align: left; padding: 8px; font-weight: bold; width: 40%;">Tipe</th>
            <th style="text-align: right; padding: 8px; font-weight: bold; width: 60%;">Harga</th>
          </tr>
          <tr style="border-bottom: 1px solid #eee;">
            <td style="padding: 8px; display: flex; align-items: center; gap: 8px;">
              <span style="display: inline-block; width: 12px; height: 12px; background: #4caf50; border-radius: 50%;"></span>
              <span>Entry</span>
            </td>
            <td style="text-align: right; padding: 8px; font-weight: bold;">${entry.toFixed(3)}</td>
          </tr>
          <tr style="border-bottom: 1px solid #eee;">
            <td style="padding: 8px; display: flex; align-items: center; gap: 8px;">
              <span style="display: inline-block; width: 12px; height: 12px; background: #f44336; border-radius: 50%;"></span>
              <span>SL</span>
            </td>
            <td style="text-align: right; padding: 8px; font-weight: bold;">${sl.toFixed(3)}</td>
          </tr>
          <tr>
            <td style="padding: 8px; display: flex; align-items: center; gap: 8px;">
              <span style="display: inline-block; width: 12px; height: 12px; background: #2196f3; border-radius: 50%;"></span>
              <span>TP</span>
            </td>
            <td style="text-align: right; padding: 8px; font-weight: bold;">${tp.toFixed(3)}</td>
          </tr>
        </table>
      `;

      document.getElementById("result").innerHTML = result;
      addToHistory(type, entry.toFixed(3), tp.toFixed(3), sl.toFixed(3));
    }

    function toggleHistory() {
      const list = document.getElementById("historyList");
      const arrow = document.getElementById("arrowIcon");

      if (list.classList.contains("show")) {
        list.classList.remove("show");
        arrow.classList.remove("rotate");
      } else {
        list.classList.add("show");
        arrow.classList.add("rotate");
      }
    }

    function resetHistory(event) {
      event.stopPropagation();
      historyData = [];
      localStorage.removeItem('rrHistory');
      historyList.innerHTML = `<div class="empty-message">Belum ada Data yang tersedia saat ini!</div>`;
      historyList.classList.add("empty-message");
      updateHistoryCount();
    }

    // Load history saat halaman pertama kali dimuat
    loadHistory();
  </script>
</body>
</html>